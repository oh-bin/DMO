<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë°”ì´íƒˆ ë¸Œë ˆìŠ¤ ë””ì§€ë°”ì´ìŠ¤ V - ì˜µì…˜ ê¸°ëŒ€ê°’ ê³„ì‚°ê¸°</title>
<style>
  body { font-family: sans-serif; background:#f7f7f7; padding:20px; }
  .container { max-width:1000px; margin:auto; background:#fff; padding:20px; border-radius:12px; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ddd; padding:6px; text-align:center; font-size:13px; }
  select, input { width:100%; padding:4px; }
  .btn { margin-top:15px; padding:10px 16px; background:#2d7ff9; color:#fff; border:none; border-radius:8px; cursor:pointer;}
  h3 { margin-top:30px; }
  .counter { font-weight:bold; margin-top:10px; }
</style>
</head>
<body>
<div class="container">

<h2>ë°”ì´íƒˆ ë¸Œë ˆìŠ¤ ë””ì§€ë°”ì´ìŠ¤ V ì˜µì…˜ ê¸°ëŒ€ê°’ ê³„ì‚°ê¸°</h2>

<!-- ================= í˜„ì¬ ì˜µì…˜ + ì ê¸ˆ (ì‹¤ì œ ëŒë¦¬ê¸°ìš© UI) ================= -->
<h3>í˜„ì¬ ì˜µì…˜ (ì‹¤ì œ ìƒì„±ìš©)</h3>
<table>
  <tr>
    <th>ìŠ¬ë¡¯</th>
    <th>ì˜µì…˜</th>
    <th>ì ê¸ˆ</th>
  </tr>
  <tbody id="currentTable"></tbody>
</table>

<button class="btn" onclick="rollOptions()">ì˜µì…˜ ëŒë¦¬ê¸°</button>

<div class="counter">
  ì‚¬ìš©í•œ ì˜µì…˜ë³€ê²½ìŠ¤í†¤: <span id="usedStone">0</span> ê°œ
</div>

<!-- ================= ê¸°ëŒ€ê°’ ì „ìš© ì„¤ì • ================= -->
<h3>ê¸°ëŒ€ê°’ ê³„ì‚°ìš© ì„¤ì • (ë³„ë„)</h3>

<h4>ì ê¸ˆ ìŠ¬ë¡¯ ì„ íƒ (ìµœëŒ€ 2ê°œ)</h4>
<table>
  <tr>
    <th>ìŠ¬ë¡¯</th>
    <th>ì ê¸ˆ ì—¬ë¶€</th>
  </tr>
  <tbody id="expectLockTable"></tbody>
</table>

<h4>ì›í•˜ëŠ” ìµœì¢… ì˜µì…˜ (ì´ 5ê°œ)</h4>
<table>
  <tr>
    <th>ìŠ¬ë¡¯</th>
    <th>ì›í•˜ëŠ” ì˜µì…˜</th>
  </tr>
  <tbody id="targetOptionTable"></tbody>
</table>

<button class="btn" onclick="calculateExpectation()">ê¸°ëŒ€ ì˜µì…˜ë³€ê²½ ìŠ¤í†¤ ê³„ì‚°</button>

<div id="resultBox" style="margin-top:20px; font-weight:bold;"></div>

</div>

<script>
// ================= ì˜µì…˜ ì •ì˜ =================
const optionPool = [
  {name:"ê³µê²©ë ¥", max:2},
  {name:"ë°©ì–´ë ¥", max:2},
  {name:"ìµœëŒ€ì²´ë ¥", max:2},
  {name:"ë””ì§€ì†Œìš¸", max:2},
  {name:"ìŠ¤í‚¬í”¼í•´", max:2},
  {name:"í¬ë¦¬í‹°ì»¬", max:2},
  {name:"ì¹˜ëª…í”¼í•´", max:2},
  {name:"íšŒí”¼", max:2},
  {name:"ì ì¤‘ë„", max:2},
  {name:"ë°©ì–´ë ¥%", max:1},
  {name:"ìµœëŒ€ DS ì¦ê°€%", max:1},
  {name:"ìµœëŒ€ HP ì¦ê°€%", max:1},
  {name:"ìŠ¤í‚¬ ë°ë¯¸ì§€ ì¦ê°€%", max:1},
  {name:"ìµœì¢… ë°ë¯¸ì§€ ì¦ê°€%", max:1},
];

let usedStone = 0;

const currentTable = document.getElementById("currentTable");
const expectLockTable = document.getElementById("expectLockTable");
const targetTable = document.getElementById("targetOptionTable");

function createOptionSelect() {
  const sel = document.createElement("select");
  const empty = document.createElement("option");
  empty.value = "";
  empty.textContent = "- ì„ íƒ -";
  sel.appendChild(empty);
  optionPool.forEach(opt=>{
    const o = document.createElement("option");
    o.value = opt.name;
    o.textContent = opt.name;
    sel.appendChild(o);
  });
  return sel;
}

// ================= í˜„ì¬ ìŠ¬ë¡¯ ìƒì„± =================
for(let i=1;i<=5;i++){
  const tr = document.createElement("tr");
  const tdSlot = document.createElement("td");
  const tdOpt = document.createElement("td");
  const tdLock = document.createElement("td");

  tdSlot.textContent = i;

  const sel = createOptionSelect();
  const chk = document.createElement("input");
  chk.type = "checkbox";

  tdOpt.appendChild(sel);
  tdLock.appendChild(chk);

  tr.appendChild(tdSlot);
  tr.appendChild(tdOpt);
  tr.appendChild(tdLock);

  currentTable.appendChild(tr);
}

// ================= ê¸°ëŒ€ê°’ìš© ì ê¸ˆ ìŠ¬ë¡¯ =================
for(let i=1;i<=5;i++){
  const tr = document.createElement("tr");
  const tdSlot = document.createElement("td");
  const tdChk  = document.createElement("td");

  tdSlot.textContent = i;
  const chk = document.createElement("input");
  chk.type = "checkbox";
  chk.className = "expect-lock";

  tdChk.appendChild(chk);
  tr.appendChild(tdSlot);
  tr.appendChild(tdChk);

  expectLockTable.appendChild(tr);
}

// ================= ê¸°ëŒ€ê°’ìš© ì›í•˜ëŠ” ì˜µì…˜ ìŠ¬ë¡¯ =================
for(let i=1;i<=5;i++){
  const tr = document.createElement("tr");
  const tdSlot = document.createElement("td");
  const tdOpt  = document.createElement("td");

  tdSlot.textContent = i;
  const sel = createOptionSelect();

  tdOpt.appendChild(sel);

  tr.appendChild(tdSlot);
  tr.appendChild(tdOpt);
  targetTable.appendChild(tr);
}

// ================= ì‹¤ì œ ì˜µì…˜ ëŒë¦¬ê¸° (ëŒë¦´ ë•Œë§ˆë‹¤ ìŠ¤í†¤ ëˆ„ì ) =================
function rollOptions(){
  const rows = currentTable.querySelectorAll("tr");

  let lockCount = 0;
  rows.forEach(row=>{
    const chk = row.children[2].querySelector("input");
    if(chk.checked) lockCount++;
  });

  let cost = 1;
  if(lockCount===1) cost = 3;
  if(lockCount===2) cost = 5;

  usedStone += cost;
  document.getElementById("usedStone").innerText = usedStone;

  // ëœë¤ ì˜µì…˜ ìƒì„± (ì ê¸ˆëœ ìŠ¬ë¡¯ì€ ìœ ì§€)
  let pool = [];
  optionPool.forEach(opt=>{
    for(let i=0;i<opt.max;i++){
      pool.push(opt.name);
    }
  });

  rows.forEach(row=>{
    const sel = row.children[1].querySelector("select");
    const chk = row.children[2].querySelector("input");
    if(chk.checked) return;

    const idx = Math.floor(Math.random()*pool.length);
    const val = pool[idx];
    sel.value = val;
    pool.splice(idx,1);
  });
}

// ================= ê¸°ëŒ€ê°’ ê³„ì‚° =================
function calculateExpectation(){
  const lockChecks = document.querySelectorAll(".expect-lock");
  const targetSelects = targetTable.querySelectorAll("select");

  let lockedSlots = [];
  lockChecks.forEach((chk,idx)=>{
    if(chk.checked) lockedSlots.push(idx);
  });

  if(lockedSlots.length>2){
    document.getElementById("resultBox").innerText = "ì ê¸ˆ ìŠ¬ë¡¯ì€ ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.";
    return;
  }

  const targetOptions = [];
  targetSelects.forEach(sel=>{
    targetOptions.push(sel.value);
  });

  if(targetOptions.includes("")){
    document.getElementById("resultBox").innerText = "ì›í•˜ëŠ” ì˜µì…˜ 5ê°œë¥¼ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”.";
    return;
  }

  let totalPool = 0;
  optionPool.forEach(o=> totalPool += o.max);

  let p = 1;
  let removed = 0;

  for(let i=0;i<5;i++){
    if(lockedSlots.includes(i)) continue;

    const target = targetOptions[i];
    const allowed = optionPool.find(o=>o.name===target)?.max || 0;

    const remainPool = totalPool - removed;

    p *= (allowed / remainPool);
    removed++;
  }

  let stoneCost = 1;
  if(lockedSlots.length===1) stoneCost = 3;
  if(lockedSlots.length===2) stoneCost = 5;

  const expectedTry = 1 / p;
  const expectedStone = expectedTry * stoneCost;

  document.getElementById("resultBox").innerHTML = `
    ì´ í™•ë¥ : ${(p*100).toFixed(8)}%<br>
    ì‹œë„ ê¸°ëŒ€ íšŸìˆ˜: ${expectedTry.toFixed(2)} íšŒ<br>
    ì˜µì…˜ë³€ê²½ ìŠ¤í†¤ 1íšŒë‹¹ ì†Œëª¨: ${stoneCost} ê°œ<br><br>
    ğŸ‘‰ <b>ê¸°ëŒ€ ì˜µì…˜ë³€ê²½ ìŠ¤í†¤ ê°œìˆ˜: ${Math.round(expectedStone)}</b> ê°œ
  `;
}
</script>

</body>
</html>
