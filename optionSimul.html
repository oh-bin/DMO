<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜µì…˜ ê¸°ëŒ€ê°’ ê³„ì‚°ê¸°</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; padding: 20px; }
    .box { background:#fff; padding:15px; border-radius:10px; margin-bottom:20px; }
    select, button, input { margin:5px 0; padding:5px; }
    .slot { font-weight:bold; margin:4px 0; }
    .locked { color:#1976d2; font-weight:bold;}
  </style>
</head>
<body>

<h2>ì˜µì…˜ ë½‘ê¸°</h2>
<div class="box">
  <div id="currentSlots"></div>
  <button onclick="rollOptions()">ì˜µì…˜ à¤ªà¥à¤¨ì„¤ì •</button>
  <p>ì‚¬ìš©í•œ ì˜µì…˜ë³€ê²½ìŠ¤í†¤: <span id="usedStones">0</span> ê°œ</p>
</div>

<h2>ê¸°ëŒ€ê°’ ê³„ì‚° ì„¤ì •</h2>
<div class="box">
  <h4>ì›í•˜ëŠ” ì˜µì…˜ 5ê°œ ì„ íƒ</h4>
  <div id="desiredOptions"></div>

  <h4>ê¸°ëŒ€ê°’ìš© ì ê¸ˆ ìŠ¬ë¡¯ ì„ íƒ</h4>
  <div id="expectedLocks"></div>

  <button onclick="calculateExpected()">ê¸°ëŒ€ê°’ ê³„ì‚°</button>
  <p id="expectedResult"></p>
</div>

<script>
/* ===== ì˜µì…˜ ë°ì´í„° ===== */
const options = [
  {name:"ê³µê²©ë ¥", max:2},
  {name:"ë°©ì–´ë ¥", max:2},
  {name:"ìµœëŒ€ì²´ë ¥", max:2},
  {name:"ë””ì§€ì†Œìš¸", max:2},
  {name:"ìŠ¤í‚¬í”¼í•´", max:2},
  {name:"í¬ë¦¬í‹°ì»¬", max:2},
  {name:"ì¹˜ëª…í”¼í•´", max:2},
  {name:"íšŒí”¼", max:2},
  {name:"ì ì¤‘ë„", max:2},
  {name:"ë°©ì–´ë ¥%", max:1},
  {name:"ìµœëŒ€ DS ì¦ê°€%", max:1},
  {name:"ìµœëŒ€ HP ì¦ê°€%", max:1},
  {name:"ìŠ¤í‚¬ ë°ë¯¸ì§€ ì¦ê°€%", max:1},
  {name:"ìµœì¢… ë°ë¯¸ì§€ ì¦ê°€%", max:1}
];

const PROB = 0.0434; // 4.34%
let usedStone = 0;
let current = ["","","","",""];

/* ===== ìŠ¬ë¡¯ ì¶œë ¥ ===== */
function renderSlots() {
  const div = document.getElementById("currentSlots");
  div.innerHTML = "";
  current.forEach((o,i)=>{
    div.innerHTML += `<div class="slot">ìŠ¬ë¡¯ ${i+1}: ${o || "-"}</div>`;
  });
}

function rollOptions() {
  let pool = [];
  options.forEach(opt=>{
    let count=opt.max;
    for(let i=0;i<count;i++) pool.push(opt.name);
  });

  current = [];

  for(let i=0;i<5;i++){
    if(pool.length===0){
      current.push("");
      continue;
    }
    let idx = Math.floor(Math.random()*pool.length);
    current.push(pool[idx]);
    pool.splice(idx,1);
  }

  usedStone += 1;
  document.getElementById("usedStones").innerText = usedStone;
  renderSlots();
}

/* ===== UI ìƒì„± ===== */
function buildSelectors() {
  const d = document.getElementById("desiredOptions");
  const l = document.getElementById("expectedLocks");

  for(let i=0;i<5;i++){
    let sel = document.createElement("select");
    sel.id = "want_"+i;
    sel.innerHTML = `<option value="">ì„ íƒ ì•ˆí•¨</option>`;
    options.forEach(o=>{
      sel.innerHTML += `<option value="${o.name}">${o.name}</option>`;
    });
    d.appendChild(document.createTextNode((i+1)+"ë²ˆ ì˜µì…˜: "));
    d.appendChild(sel);
    d.appendChild(document.createElement("br"));

    let chk = document.createElement("input");
    chk.type="checkbox";
    chk.id="lock_"+i;
    l.appendChild(document.createTextNode((i+1)+"ë²ˆ ìŠ¬ë¡¯ ì ê¸ˆ: "));
    l.appendChild(chk);
    l.appendChild(document.createElement("br"));
  }
}
buildSelectors();
renderSlots();

/* ===== ê¸°ëŒ€ê°’ ê³„ì‚° ===== */
function calculateExpected() {
  let desired = [];
  let lockCount = 0;

  for(let i=0;i<5;i++){
    const val = document.getElementById("want_"+i).value;
    if(val) desired.push(val);
    if(document.getElementById("lock_"+i).checked) lockCount++;
  }

  const cost = lockCount===0?1:(lockCount===1?3:5);

  // ë‹¨ìˆœ í™•ë¥  ëª¨ë¸
  const p = Math.pow(PROB, desired.length);
  let expected = p===0?0:(1/p);

  let result = `
    ğŸ”¹ ì„ íƒ ì˜µì…˜ ê°œìˆ˜: ${desired.length} <br>
    ğŸ”¹ ì ê¸ˆ ê°œìˆ˜: ${lockCount} <br>
    ğŸ”¹ 1íšŒ ì†Œëª¨ ìŠ¤í†¤: ${cost} <br>
    ğŸ”¹ ê¸°ëŒ€ ì‹œë„ íšŸìˆ˜: ${expected.toFixed(2)} íšŒ <br>
    ğŸ”¹ ê¸°ëŒ€ ìŠ¤í†¤ ì†Œëª¨ëŸ‰: ${(expected*cost).toFixed(2)} ê°œ
  `;
  document.getElementById("expectedResult").innerHTML = result;
}
</script>
</body>
</html>
