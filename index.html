<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>장비 강화 기대값 계산기</title>
  <style>
    body { font-family: sans-serif; background:#f7f7f7; padding:20px; }
    .container { max-width:900px; margin:auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.05); }
    .grid { display:grid; grid-template-columns: repeat(5, 1fr); gap:16px; margin-bottom:20px; }
    .item-card { border:1px solid #ddd; border-radius:12px; padding:10px; text-align:center; }
    .item-card img { width:100px; height:100px; object-fit:contain; border:1px dashed #ccc; border-radius:8px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:#f0f0f0; }
    input { width:100%; box-sizing:border-box; padding:5px; }
    .btn { margin-top:20px; padding:12px 20px; border:none; background:#2d7ff9; color:#fff; border-radius:10px; cursor:pointer; font-size:16px; }
    .result { margin-top:20px; padding:15px; background:#f1f8ff; border-radius:10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>디지몬 마스터즈 장비 강화 기대값 계산기</h1>

    <h3>장비 이미지</h3>
    <div class="grid">
      <div class="item-card"><div>모자</div><img id="img-hat" /><input type="file" accept="image/*" onchange="loadImage(event, 'img-hat')"></div>
      <div class="item-card"><div>가방</div><img id="img-bag" /><input type="file" accept="image/*" onchange="loadImage(event, 'img-bag')"></div>
      <div class="item-card"><div>상의</div><img id="img-top" /><input type="file" accept="image/*" onchange="loadImage(event, 'img-top')"></div>
      <div class="item-card"><div>바지</div><img id="img-pants" /><input type="file" accept="image/*" onchange="loadImage(event, 'img-pants')"></div>
      <div class="item-card"><div>신발</div><img id="img-shoes" /><input type="file" accept="image/*" onchange="loadImage(event, 'img-shoes')"></div>
    </div>

    <h3>강화 확률 및 비용 입력</h3>
    <table id="probTable">
      <thead>
        <tr>
          <th>단계</th>
          <th>성공 확률 (%)</th>
          <th>실패 유지 확률 (%)</th>
          <th>하락 확률 (%)</th>
          <th>파괴 확률 (%)</th>
          <th>1회 비용</th>
        </tr>
      </thead>
      <tbody>
        <script>
          for (let i = 1; i <= 15; i++) {
            document.write(`
              <tr>
                <td>${i}</td>
                <td><input type="number" step="0.01" id="suc-${i}" /></td>
                <td><input type="number" step="0.01" id="keep-${i}" /></td>
                <td><input type="number" step="0.01" id="down-${i}" /></td>
                <td><input type="number" step="0.01" id="break-${i}" /></td>
                <td><input type="number" id="cost-${i}" /></td>
              </tr>
            `);
          }
        </script>
      </tbody>
    </table>

    <button class="btn" onclick="calculate()">기대값 계산</button>

    <div class="result" id="result"></div>
  </div>

  <script>
    function loadImage(event, id) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        document.getElementById(id).src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function calculate() {
      let totalCost = 0;
      let successRateAccum = 1;

      for (let i = 1; i <= 15; i++) {
        const suc = parseFloat(document.getElementById(`suc-${i}`).value) || 0;
        const breakP = parseFloat(document.getElementById(`break-${i}`).value) || 0;
        const cost = parseFloat(document.getElementById(`cost-${i}`).value) || 0;

        const pSuccess = suc / 100;
        const pBreak = breakP / 100;

        if (pSuccess === 0) continue;

        // 단순 기대 시도 횟수
        const expectedTries = 1 / (pSuccess || 1);
        totalCost += expectedTries * cost;

        // 파괴 고려 간이 보정
        successRateAccum *= (1 - pBreak);
      }

      document.getElementById('result').innerHTML = `
        <h3>계산 결과</h3>
        <p>총 예상 비용: <b>${totalCost.toLocaleString()}</b></p>
        <p>파괴 미발생 누적 확률: <b>${(successRateAccum*100).toFixed(2)}%</b></p>
      `;
    }
  </script>
</body>
</html>