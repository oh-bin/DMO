// ===== 장비별 강화 비용 및 재료 =====
const equipCosts = {
  "기본": [
    {bit:5500000, material:""},
    {bit:6050000, material:""},
    {bit:6655000, material:""},
    {bit:7320500, material:""},
    {bit:8784600, material:""},
    {bit:10541520, material:""},
    {bit:12649820, material:""},
    {bit:15179790, material:""},
    {bit:18215750, material:""},
    {bit:23680470, material:""},
    {bit:30784610, material:""},
    {bit:40020000, material:""},
    {bit:56027990, material:""},
    {bit:78439190, material:""},
    {bit:117658800, material:""}
  ],
  "고스트 키링": [
    {bit:10000000, material:"나이프1 10t"},
    {bit:11000000, material:"나이프1 11t"},
    {bit:12100000, material:"나이프1 12.1t"},
    {bit:13310000, material:"나이프1 13.31t"},
    {bit:15972000, material:"나이프2 15.972t"},
    {bit:19166400, material:"나이프2 19.166.4t"},
    {bit:22999680, material:"나이프2 22.999.680t"},
    {bit:27599620, material:"나이프2 27.599.620t"},
    {bit:33119540, material:"나이프2 33.119.540t"},
    {bit:43055400, material:"나이프3 43.055.400t"},
    {bit:0, material:""}, // 10->11 이후는 임의로 0
    {bit:0, material:""},
    {bit:0, material:""},
    {bit:0, material:""},
    {bit:0, material:""}
  ]
};

// ===== 강화 단계 설명 테이블 =====
function updateTable() {
  const tbody = document.querySelector("#infoTable tbody");
  tbody.innerHTML = ""; // 초기화

  const equip = equipSelect.value;
  const costs = equip === "고스트 키링" ? equipCosts["고스트 키링"] : equipCosts["기본"];

  for(let i=0;i<15;i++){
    const failBase = (1 - baseSuccess[i] - breakRates[i])*100;
    const failExtra = (1 - extraSuccess[i] - breakRates[i])*100;
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i} → ${i+1}</td>
      <td>${(baseSuccess[i]*100).toFixed(1)}%</td>
      <td>${failBase.toFixed(1)}%</td>
      <td>${(extraSuccess[i]*100).toFixed(1)}%</td>
      <td>${failExtra.toFixed(1)}%</td>
      <td>${(breakRates[i]*100).toFixed(1)}%</td>
      <td>${formatCost(costs[i].bit)} ${costs[i].material}</td>
    `;
    tbody.appendChild(tr);
  }
}

// ===== 계산 함수 수정 =====
function calculate(){
  const start = parseInt(startSelect.value);
  const target = parseInt(targetSelect.value);
  const useExtra = document.getElementById('extraMat').checked;

  if(target <= start){
    alert("목표 단계는 시작 단계보다 커야 합니다.");
    return;
  }

  const equip = equipSelect.value;
  const costs = equip === "고스트 키링" ? equipCosts["고스트 키링"] : equipCosts["기본"];
  let totalCostBit = 0;
  let totalMaterials = {};

  for(let i=start;i<target;i++){
    const cost = costs[i].bit;
    const pSuccess = useExtra ? extraSuccess[i] : baseSuccess[i];
    const expectedTries = 1 / pSuccess;
    totalCostBit += expectedTries * cost;

    if(costs[i].material){
      const matName = costs[i].material;
      totalMaterials[matName] = (totalMaterials[matName] || 0) + expectedTries;
    }
  }

  let materialStr = Object.entries(totalMaterials).map(([k,v]) => `${k} x${v.toFixed(2)}`).join(", ");

  document.getElementById('result').innerHTML = `
    <h3>계산 결과</h3>
    <p>총 예상 비용: <b>${formatCost(Math.round(totalCostBit))}</b></p>
    <p>필요 재료: <b>${materialStr || "없음"}</b></p>
  `;
}
